# üë• Users API ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

## –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏.

## –§–∞–π–ª—ã

- `main.py` ‚Äî FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `schemas.py` ‚Äî Pydantic —Å—Ö–µ–º—ã (–∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã)

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### `POST /api/users/register`
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**Request:**
```json
{
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "login": "ivanov",
  "email": "ivanov@example.com",
  "phone": "+998901234567",
  "password": "SecurePass123",
  "role_id": 2,
  "work_start_time": "09:00",
  "work_end_time": "18:00",
  "work_days": ["–ü–ù", "–í–¢", "–°–†", "–ß–¢", "–ü–¢"]
}
```

**Response:**
```json
{
  "id": 5,
  "login": "ivanov",
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "email": "ivanov@example.com",
  "role": {
    "id": 2,
    "name": "–ü—Ä–æ–¥–∞–∂–Ω–∏–∫"
  }
}
```

#### `GET /api/users/me`
–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Response:**
```json
{
  "id": 5,
  "login": "ivanov",
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "email": "ivanov@example.com",
  "phone": "+998901234567",
  "role": {
    "id": 2,
    "name": "–ü—Ä–æ–¥–∞–∂–Ω–∏–∫"
  },
  "work_start_time": "09:00",
  "work_end_time": "18:00",
  "work_days": ["–ü–ù", "–í–¢", "–°–†", "–ß–¢", "–ü–¢"]
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### `GET /api/users/`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `role_id` (optional) ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏

**Response:**
```json
[
  {
    "id": 1,
    "login": "admin",
    "first_name": "–ê–¥–º–∏–Ω",
    "role": {"id": 1, "name": "–ê–¥–º–∏–Ω"}
  },
  ...
]
```

#### `PATCH /api/users/update_user`
–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request:**
```json
{
  "user_id": 5,
  "first_name": "–ù–æ–≤–æ–µ –∏–º—è",
  "email": "newemail@example.com"
}
```

#### `DELETE /api/users/delete_user`
–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**Request:**
```json
{
  "user_id": 5
}
```

#### `POST /api/users/reset_password`
–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Request:**
```json
{
  "user_id": 5,
  "new_password": "NewSecurePass123"
}
```

## –†–æ–ª–∏

ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ
---|----------|----------
1 | –ê–¥–º–∏–Ω | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
2 | –ü—Ä–æ–¥–∞–∂–Ω–∏–∫ | –†–∞–±–æ—Ç–∞ —Å –ª–∏–¥–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö —Å–¥–µ–ª–æ–∫
3 | –§–∏–Ω–∞–Ω—Å–∏—Å—Ç | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤
4 | –ú–û–ü | –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂
5 | –†–û–ü | –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂

## –ú–æ–¥–µ–ª–∏ –ë–î

### User
```python
- id: int (PK)
- first_name: str
- last_name: str
- login: str (UNIQUE)
- email: str (UNIQUE)
- phone: str
- hashed_password: str
- role_id: int (FK -> Role)
- work_start_time: str
- work_end_time: str
- work_days: JSON
- background_theme: str
- reg_date: datetime
- last_login: datetime
```

### Role
```python
- id: int (PK)
- name: str (UNIQUE)
- description: str
```

## CRUD —Ñ—É–Ω–∫—Ü–∏–∏

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `backend/database/userservice.py`

- `get_user_by_login(login: str)` ‚Äî –Ω–∞–π—Ç–∏ –ø–æ –ª–æ–≥–∏–Ω—É
- `get_user_by_email(email: str)` ‚Äî –Ω–∞–π—Ç–∏ –ø–æ email
- `create_user(db, data)` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `update_user(db, user_id, data)` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- `delete_user(db, user_id)` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API

```javascript
const response = await fetch('/api/users/register', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    first_name: "–ò–≤–∞–Ω",
    last_name: "–ò–≤–∞–Ω–æ–≤",
    login: "ivanov",
    email: "ivanov@example.com",
    phone: "+998901234567",
    password: "SecurePass123",
    role_id: 2
  })
});

const user = await response.json();
console.log('–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user.login);
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
const response = await fetch('/api/users/me');
const user = await response.json();
console.log('–í—ã –≤–æ—à–ª–∏ –∫–∞–∫:', user.login, '(' + user.role.name + ')');
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT —Ç–æ–∫–µ–Ω—ã (—Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `.env`)
- HTTP-only cookies –¥–ª—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü
- Bearer token –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–∞—Ä–æ–ª–∏
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ bcrypt
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: 8 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã + —Ü–∏—Ñ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `backend/core/auth.py`

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- –ê–¥–º–∏–Ω –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
- –ü—Ä–æ–¥–∞–∂–Ω–∏–∫–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ª–∏–¥—ã

## –û—à–∏–±–∫–∏

–ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞
----|----------|--------
400 | Bad Request | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
401 | Unauthorized | –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞
403 | Forbidden | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ (–Ω–µ –∞–¥–º–∏–Ω)
404 | Not Found | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
409 | Conflict | –õ–æ–≥–∏–Ω –∏–ª–∏ email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

- **Leads** ‚Äî –∫–∞–∂–¥—ã–π –ª–∏–¥ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ø—Ä–æ–¥–∞–∂–Ω–∏–∫—É)
- **Finance** ‚Äî –ø–ª–∞—Ç–µ–∂–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–∞–º–∏)
- **Instagram** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

1. –î–æ–±–∞–≤–∏—Ç—å —Å—Ö–µ–º—É –≤ `schemas.py`:
```python
class NewFeatureRequest(BaseModel):
    field1: str
    field2: int
```

2. –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `main.py`:
```python
@router.post("/new-endpoint")
def new_endpoint(data: NewFeatureRequest, user = Depends(get_current_user)):
    # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
    return {"status": "ok"}
```

3. –î–æ–±–∞–≤–∏—Ç—å CRUD —Ñ—É–Ω–∫—Ü–∏—é –≤ `backend/database/userservice.py` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ).

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ß–µ—Ä–µ–∑ curl
curl -X POST http://localhost:8000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"login": "test", "password": "Test1234", ...}'

# –ß–µ—Ä–µ–∑ Swagger UI
http://localhost:8000/docs
```

## TODO

- [ ] –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ email
- [ ] –ò—Å—Ç–æ—Ä–∏—è –≤—Ö–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ (permissions)

---

**–ê–≤—Ç–æ—Ä:** RealEstate CRM Team  
**–î–∞—Ç–∞:** 2025









