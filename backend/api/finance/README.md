# üí∞ Finance API ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏

## –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å –¥–ª—è —É—á—ë—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ —Å–¥–µ–ª–∫–∞–º, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –∫–æ–º–ø–∞–Ω–∏–∏, —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–π –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞–º –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## –§–∞–π–ª—ã

- `main.py` ‚Äî FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `schemas.py` ‚Äî Pydantic —Å—Ö–µ–º—ã

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –¢–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π

–¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
----|----------|---------------
`–ê–≤–∞–Ω—Å` | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å | –ü—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã
`–ò–ø–æ—Ç–µ–∫–∞` | –ü–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ –±–∞–Ω–∫ | –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏–ø–æ—Ç–µ–∫–∏
`–†–∞—Å—Å—Ä–æ—á–∫–∞` | –ü–ª–∞—Ç—ë–∂ —á–∞—Å—Ç—è–º–∏ | –ü–ª–∞–Ω —Ä–∞—Å—Å—Ä–æ—á–∫–∏ –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∞
`–ù–∞–ª–∏—á–Ω—ã–µ` | –ü–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞ | –û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏
`–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥` | –ë–µ–∑–Ω–∞–ª–∏—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂ | –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Å—á—ë—Ç –∫–æ–º–ø–∞–Ω–∏–∏

### –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π

–°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ
-------|----------
`pending` | –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
`completed` | –û–ø–ª–∞—á–µ–Ω–æ
`failed` | –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã
`cancelled` | –û—Ç–º–µ–Ω–µ–Ω–æ

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤

- **–ó–∞—Ä–ø–ª–∞—Ç—ã** ‚Äî –≤—ã–ø–ª–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
- **–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥** ‚Äî —Ä–µ–∫–ª–∞–º–∞, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ
- **–ê—Ä–µ–Ω–¥–∞** ‚Äî –∞—Ä–µ–Ω–¥–∞ –æ—Ñ–∏—Å–∞
- **–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏** ‚Äî —Å–≤–µ—Ç, –≤–æ–¥–∞, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- **–ó–∞–∫—É–ø–∫–∏** ‚Äî –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏
- **–ü—Ä–æ—á–µ–µ** ‚Äî –¥—Ä—É–≥–∏–µ —Ä–∞—Å—Ö–æ–¥—ã

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü–ª–∞—Ç–µ–∂–∏

#### `POST /api/finance/payment`
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂.

**Request:**
```json
{
  "lead_id": 123,
  "amount": 5000,
  "payment_type": "–ê–≤–∞–Ω—Å",
  "payment_date": "2025-12-03",
  "notes": "–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å –∑–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É ‚Ññ45"
}
```

**Response:**
```json
{
  "id": 456,
  "lead_id": 123,
  "amount": 5000,
  "payment_type": "–ê–≤–∞–Ω—Å",
  "status": "completed",
  "payment_date": "2025-12-03",
  "created_at": "2025-12-03T10:00:00Z",
  "created_by": {
    "id": 3,
    "first_name": "–§–∏–Ω–∞–Ω—Å–∏—Å—Ç",
    "last_name": "–ü–µ—Ç—Ä–æ–≤"
  }
}
```

#### `GET /api/finance/payments`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `lead_id` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –ª–∏–¥—É
- `status` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `payment_type` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
- `date_from` ‚Äî —Å –∫–∞–∫–æ–π –¥–∞—Ç—ã
- `date_to` ‚Äî –ø–æ –∫–∞–∫—É—é –¥–∞—Ç—É
- `page` ‚Äî –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `size` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**Response:**
```json
{
  "items": [
    {
      "id": 456,
      "lead_id": 123,
      "client_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
      "amount": 5000,
      "payment_type": "–ê–≤–∞–Ω—Å",
      "status": "completed",
      "payment_date": "2025-12-03"
    },
    ...
  ],
  "total": 150,
  "page": 1,
  "size": 20,
  "total_amount": 250000
}
```

#### `GET /api/finance/payment/{payment_id}`
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ.

**Response:**
```json
{
  "id": 456,
  "lead": {
    "id": 123,
    "client_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    "phone": "+998901234567"
  },
  "amount": 5000,
  "payment_type": "–ê–≤–∞–Ω—Å",
  "status": "completed",
  "payment_date": "2025-12-03",
  "notes": "–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å –∑–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É ‚Ññ45",
  "created_at": "2025-12-03T10:00:00Z",
  "created_by": {
    "id": 3,
    "first_name": "–§–∏–Ω–∞–Ω—Å–∏—Å—Ç",
    "last_name": "–ü–µ—Ç—Ä–æ–≤"
  }
}
```

#### `PATCH /api/finance/payment/{payment_id}`
–û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂.

**Request:**
```json
{
  "status": "completed",
  "notes": "–ü–ª–∞—Ç—ë–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –±–∞–Ω–∫–æ–º"
}
```

#### `DELETE /api/finance/payment/{payment_id}`
–£–¥–∞–ª–∏—Ç—å –ø–ª–∞—Ç—ë–∂ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ –†–û–ü).

### –†–∞—Å—Ö–æ–¥—ã

#### `POST /api/finance/expense`
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥.

**Request:**
```json
{
  "category": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",
  "amount": 1000,
  "description": "–†–µ–∫–ª–∞–º–∞ –≤ Instagram",
  "expense_date": "2025-12-03"
}
```

**Response:**
```json
{
  "id": 789,
  "category": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",
  "amount": 1000,
  "description": "–†–µ–∫–ª–∞–º–∞ –≤ Instagram",
  "expense_date": "2025-12-03",
  "created_by": {
    "id": 5,
    "first_name": "–†–û–ü",
    "last_name": "–°–∏–¥–æ—Ä–æ–≤"
  }
}
```

#### `GET /api/finance/expenses`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `category` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `date_from` ‚Äî —Å –∫–∞–∫–æ–π –¥–∞—Ç—ã
- `date_to` ‚Äî –ø–æ –∫–∞–∫—É—é –¥–∞—Ç—É
- `page` ‚Äî –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `size` ‚Äî —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**Response:**
```json
{
  "items": [
    {
      "id": 789,
      "category": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",
      "amount": 1000,
      "description": "–†–µ–∫–ª–∞–º–∞ –≤ Instagram",
      "expense_date": "2025-12-03"
    },
    ...
  ],
  "total": 50,
  "page": 1,
  "size": 20,
  "total_amount": 15000
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### `GET /api/finance/statistics`
–ü–æ–ª—É—á–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date_from` ‚Äî –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `date_to` ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞

**Response:**
```json
{
  "period": {
    "from": "2025-12-01",
    "to": "2025-12-31"
  },
  "income": {
    "total": 500000,
    "by_type": {
      "–ê–≤–∞–Ω—Å": 150000,
      "–ò–ø–æ—Ç–µ–∫–∞": 200000,
      "–†–∞—Å—Å—Ä–æ—á–∫–∞": 100000,
      "–ù–∞–ª–∏—á–Ω—ã–µ": 50000
    }
  },
  "expenses": {
    "total": 50000,
    "by_category": {
      "–ó–∞—Ä–ø–ª–∞—Ç—ã": 30000,
      "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥": 10000,
      "–ê—Ä–µ–Ω–¥–∞": 5000,
      "–ü—Ä–æ—á–µ–µ": 5000
    }
  },
  "profit": 450000,
  "commissions": {
    "total": 25000,
    "by_seller": [
      {
        "seller_id": 5,
        "seller_name": "–ü—Ä–æ–¥–∞–∂–Ω–∏–∫ –ò–≤–∞–Ω–æ–≤",
        "sales_count": 3,
        "total_amount": 150000,
        "commission": 7500
      },
      ...
    ]
  }
}
```

#### `GET /api/finance/seller_commission/{seller_id}`
–ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `date_from` ‚Äî –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞
- `date_to` ‚Äî –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞

**Response:**
```json
{
  "seller": {
    "id": 5,
    "first_name": "–ü—Ä–æ–¥–∞–∂–Ω–∏–∫",
    "last_name": "–ò–≤–∞–Ω–æ–≤"
  },
  "period": {
    "from": "2025-12-01",
    "to": "2025-12-31"
  },
  "sales_count": 3,
  "total_sales_amount": 150000,
  "commission_rate": 0.05,
  "commission_amount": 7500,
  "sales": [
    {
      "lead_id": 123,
      "client_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
      "amount": 50000,
      "date": "2025-12-05",
      "commission": 2500
    },
    ...
  ]
}
```

## –ú–æ–¥–µ–ª–∏ –ë–î

### Payment
```python
- id: int (PK)
- lead_id: int (FK -> Lead)
- amount: float
- payment_type: str (–ê–≤–∞–Ω—Å, –ò–ø–æ—Ç–µ–∫–∞, –†–∞—Å—Å—Ä–æ—á–∫–∞, –∏ —Ç.–¥.)
- status: str (pending, completed, failed, cancelled)
- payment_date: date
- notes: str (optional)
- created_by: int (FK -> User)
- created_at: datetime
- updated_at: datetime
```

### Expense
```python
- id: int (PK)
- category: str (–ó–∞—Ä–ø–ª–∞—Ç—ã, –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥, –∏ —Ç.–¥.)
- amount: float
- description: str
- expense_date: date
- created_by: int (FK -> User)
- created_at: datetime
```

## CRUD —Ñ—É–Ω–∫—Ü–∏–∏

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `backend/database/finance_service/crud.py`

### –ü–ª–∞—Ç–µ–∂–∏
- `create_payment(db, data)` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂
- `get_payment_by_id(db, payment_id)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞—Ç—ë–∂ –ø–æ ID
- `get_payments(db, filters)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π
- `update_payment(db, payment_id, data)` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂
- `delete_payment(db, payment_id)` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–ª–∞—Ç—ë–∂

### –†–∞—Å—Ö–æ–¥—ã
- `create_expense(db, data)` ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Ö–æ–¥
- `get_expenses(db, filters)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤
- `delete_expense(db, expense_id)` ‚Äî —É–¥–∞–ª–∏—Ç—å —Ä–∞—Å—Ö–æ–¥

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `get_total_income(db, date_from, date_to)` ‚Äî –æ–±—â–∏–π –¥–æ—Ö–æ–¥
- `get_total_expenses(db, date_from, date_to)` ‚Äî –æ–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã
- `calculate_seller_commission(db, seller_id, date_from, date_to)` ‚Äî –∫–æ–º–∏—Å—Å–∏—è –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞

## –†–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π

### –°—Ö–µ–º–∞ –∫–æ–º–∏—Å—Å–∏–π

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–º–∏—Å—Å–∏—è –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç **5%** –æ—Ç —Å—É–º–º—ã —Å–¥–µ–ª–∫–∏.

–ü—Ä–∏–º–µ—Ä:
- –°–¥–µ–ª–∫–∞ –Ω–∞ $50,000
- –ö–æ–º–∏—Å—Å–∏—è: $50,000 √ó 0.05 = $2,500

### –£—Å–ª–æ–≤–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

–ö–æ–º–∏—Å—Å–∏—è –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è:
- ‚úÖ –ö–æ–≥–¥–∞ –ª–∏–¥ –∑–∞–∫—Ä—ã—Ç (—Å—Ç–∞—Ç—É—Å "–∑–∞–∫—Ä—ã—Ç")
- ‚úÖ –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–Ω –ø–ª–∞—Ç—ë–∂ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "completed"
- ‚úÖ –ó–∞ –∫–∞–∂–¥—ã–π –ø–ª–∞—Ç—ë–∂ –æ—Ç–¥–µ–ª—å–Ω–æ (–¥–ª—è —Ä–∞—Å—Å—Ä–æ—á–∫–∏)

–ö–æ–º–∏—Å—Å–∏—è –ù–ï –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è:
- ‚ùå –õ–∏–¥ –≤ —Å—Ç–∞—Ç—É—Å–µ "–Ω–æ–≤—ã–π" –∏–ª–∏ "–≤ —Ä–∞–±–æ—Ç–µ"
- ‚ùå –ü–ª–∞—Ç—ë–∂ –≤ —Å—Ç–∞—Ç—É—Å–µ "pending" –∏–ª–∏ "failed"
- ‚ùå –õ–∏–¥ –≤ —Å—Ç–∞—Ç—É—Å–µ "–æ—Ç–∫–∞–∑"

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ JavaScript

```javascript
async function createPayment(leadId, amount, type) {
  const response = await fetch('/api/finance/payment', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      lead_id: leadId,
      amount: amount,
      payment_type: type,
      payment_date: new Date().toISOString().split('T')[0],
      notes: `–ü–ª–∞—Ç—ë–∂ ${type}`
    })
  });
  
  if (!response.ok) {
    throw new Error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞');
  }
  
  return response.json();
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
createPayment(123, 5000, '–ê–≤–∞–Ω—Å')
  .then(payment => {
    console.log('–ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞–Ω:', payment.id);
    alert(`–ü–ª–∞—Ç—ë–∂ –Ω–∞ $${payment.amount} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`);
  });
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –º–µ—Å—è—Ü

```javascript
async function getMonthlyStatistics() {
  const now = new Date();
  const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
  const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
  
  const response = await fetch(
    `/api/finance/statistics?` +
    `date_from=${firstDay.toISOString().split('T')[0]}&` +
    `date_to=${lastDay.toISOString().split('T')[0]}`
  );
  
  return response.json();
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
getMonthlyStatistics().then(stats => {
  console.log('–î–æ—Ö–æ–¥:', stats.income.total);
  console.log('–†–∞—Å—Ö–æ–¥—ã:', stats.expenses.total);
  console.log('–ü—Ä–∏–±—ã–ª—å:', stats.profit);
});
```

### –†–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–∏ –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞

```javascript
async function getSellerCommission(sellerId, dateFrom, dateTo) {
  const response = await fetch(
    `/api/finance/seller_commission/${sellerId}?` +
    `date_from=${dateFrom}&date_to=${dateTo}`
  );
  
  return response.json();
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
getSellerCommission(5, '2025-12-01', '2025-12-31')
  .then(data => {
    console.log(`–ö–æ–º–∏—Å—Å–∏—è: $${data.commission_amount}`);
    console.log(`–ü—Ä–æ–¥–∞–∂: ${data.sales_count}`);
  });
```

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–†–æ–ª—å | –ü–ª–∞—Ç–µ–∂–∏ | –†–∞—Å—Ö–æ–¥—ã | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
-----|---------|---------|------------
–ê–¥–º–∏–Ω | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
–†–û–ü | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
–ú–û–ü | –ü—Ä–æ—Å–º–æ—Ç—Ä | –ü—Ä–æ—Å–º–æ—Ç—Ä | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–æ–≤
–§–∏–Ω–∞–Ω—Å–∏—Å—Ç | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø | –ü—Ä–æ—Å–º–æ—Ç—Ä | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
–ü—Ä–æ–¥–∞–∂–Ω–∏–∫ | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö | ‚ùå | –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–æ–º–∏—Å—Å–∏–∏

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Leads
–ü–ª–∞—Ç–µ–∂–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ª–∏–¥–∞–º. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ª–∏–¥–∞.

### Telegram Bot
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –†–û–ü –∏ —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–∞–º.

### Excel Export
–≠–∫—Å–ø–æ—Ä—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ –≤ Excel –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏.

## –û—Ç—á—ë—Ç—ã

### –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç

–í–∫–ª—é—á–∞–µ—Ç:
- –û–±—â–∏–π –¥–æ—Ö–æ–¥ –∏ —Ä–∞—Å—Ö–æ–¥—ã
- –ü—Ä–∏–±—ã–ª—å (–¥–æ—Ö–æ–¥ - —Ä–∞—Å—Ö–æ–¥—ã)
- –ö–æ–º–∏—Å—Å–∏–∏ –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–∞–º
- –¢–æ–ø –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π
- –†–∞–∑–±–∏–≤–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### –û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–Ω–∏–∫—É

–í–∫–ª—é—á–∞–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫
- –û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂
- –ö–æ–º–∏—Å—Å–∏—è
- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –ø–ª–∞—Ç–µ–∂–∞

1. –î–æ–±–∞–≤–∏—Ç—å –≤ `schemas.py`:
```python
PAYMENT_TYPES = [
    "–ê–≤–∞–Ω—Å",
    "–ò–ø–æ—Ç–µ–∫–∞",
    "–†–∞—Å—Å—Ä–æ—á–∫–∞",
    "–ù–æ–≤—ã–π —Ç–∏–ø"  # <-- –¥–æ–±–∞–≤–∏—Ç—å
]
```

2. –û–±–Ω–æ–≤–∏—Ç—å frontend –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞.

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏

–ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `calculate_seller_commission()` –≤ `crud.py`:

```python
def calculate_seller_commission(db, seller_id, date_from, date_to):
    COMMISSION_RATE = 0.05  # <-- –∏–∑–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å (0.05 = 5%)
    ...
```

–î–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂–Ω–∏–∫–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `commission_rate` –≤ –º–æ–¥–µ–ª—å `User`.

## –û—à–∏–±–∫–∏

–ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞
----|----------|--------
400 | Bad Request | –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—É–º–º–∞ –∏–ª–∏ –¥–∞—Ç–∞
401 | Unauthorized | –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞
403 | Forbidden | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ (–Ω–µ —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç/–∞–¥–º–∏–Ω)
404 | Not Found | –ü–ª–∞—Ç—ë–∂ –∏–ª–∏ –ª–∏–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
409 | Conflict | –î—É–±–ª–∏–∫–∞—Ç –ø–ª–∞—Ç–µ–∂–∞

## TODO

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ API –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á–µ—Ç–æ–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É
- [ ] –ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è —Ä–∞—Å—Å—Ä–æ—á–∫–∏
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ 1–°:–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è
- [ ] –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ pipeline
- [ ] –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–º–∏—Å—Å–∏–π

---

**–ê–≤—Ç–æ—Ä:** RealEstate CRM Team  
**–î–∞—Ç–∞:** 2025

