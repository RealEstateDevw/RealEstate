<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/admin_style/style.css">

        <link rel="stylesheet" href="/static/register-employer-style.css">
        <title>CRM</title>
    
        <style>
            body {
                background: {% if user and user.background_theme %} url('{{ user.background_theme }}')  lightgray 50% / cover no-repeat {% else %} #ffffff {% endif %};
                transition: background 0.5s ease;
            }

          </style>
    </head>
<body>
  <div id="notification" class="notification" style="display: none;">
    <span id="notification-message"></span>
    <button id="close-notification" class="close-btn">&times;</button>
</div>
{% include 'partials/admin-header.html' %}
<main>
    {% block content %}{% endblock %}
</main>


<form id="upload-form" class="container">
  <div class="input-with-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 20.25c4.694 0 8.5-3.806 8.5-8.5S16.694 3.25 12 3.25 3.5 7.056 3.5 11.75s3.806 8.5 8.5 8.5z" /></svg>
      <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ñ–ö">
    </div>
      <!-- –ñ–ö -->
      <div class="upload-section">
        <div class="upload-header">
          <span>–î–∞–Ω–Ω—ã–µ –æ –ñ–ö</span>
          <span class="upload-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel-—Ñ–∞–π–ª—ã. –§–æ—Ä–º–∞—Ç—ã: xlsx, xls, csv</span>
        </div>
        <label class="dropzone" for="file-1">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ</label>
        <input type="file" id="file-1" name="file" multiple>
        <div class="file-list" id="list-1"></div>
      </div>

      <!-- –ü—Ä–∞–π—Å—ã -->
      <div class="upload-section">
        <div class="upload-header">
          <span>–ü—Ä–∞–π—Å—ã</span>
          <span class="upload-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel-—Ñ–∞–π–ª—ã. –§–æ—Ä–º–∞—Ç—ã: xlsx, xls, csv</span>
        </div>
        <label class="dropzone" for="file-2">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ</label>
        <input type="file" id="file-2" name="file" multiple>
        <div class="file-list" id="list-2"></div>
      </div>

      <!-- –®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤ -->
      <div class="upload-section">
        <div class="upload-header">
          <span>–®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤</span>
          <span class="upload-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Docx-—Ñ–∞–π–ª—ã. –§–æ—Ä–º–∞—Ç—ã: docx, doc</span>
        </div>
        <label class="dropzone" for="file-3">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ</label>
        <input type="file" id="file-3" name="file" multiple>
        <div class="file-list" id="list-3"></div>
      </div>

      <button type="submit" class="submit-button">
        –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ <span>‚Üí</span>
      </button>
    </form>

  <script>

    document.getElementById('upload-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –ñ–ö
    const nameInput = document.querySelector('.input-with-icon input');
    const nameValue = nameInput.value.trim();
    if (!/^–ñ–ö_.+/.test(nameValue)) {
      showNotification('–ù–∞–∑–≤–∞–Ω–∏–µ –ñ–ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–ñ–ö_–ù–∞–∑–≤–∞–Ω–∏–µ"', 'error');
      return;
    }

    const jkInput   = document.getElementById('file-1');
    const priceInput= document.getElementById('file-2');
    const tplInput  = document.getElementById('file-3');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–æ –≤—Å–µ—Ö —Ç—Ä—ë—Ö –µ—Å—Ç—å —Ñ–∞–π–ª
    if (!jkInput.files.length || !priceInput.files.length || !tplInput.files.length) {
      showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –≤–æ –≤—Å–µ—Ö —Ç—Ä—ë—Ö —Å–µ–∫—Ü–∏—è—Ö', 'error');
      return;
    }

    const fd = new FormData();
    fd.append('name', nameValue);
    fd.append('jk_file',    jkInput.files[0]);
    fd.append('price_file', priceInput.files[0]);
    fd.append('template_file', tplInput.files[0]);
    console.log(fd);
    try {
      const res = await fetch('/api/complexes/add-complex', {
        method: 'POST',
        body: fd
      });
      const json = await res.json();
      if (res.ok) {
        showNotification(json.message, 'success');
        location.reload();
      } else {
        showNotification(json.detail || json.message, 'error');
      }
    } catch (err) {
      console.error(err);
      showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
    }
  });



    function setupUpload(inputId, listId) {
      const input = document.getElementById(inputId);
      const list = document.getElementById(listId);

      input.addEventListener('change', () => {
        Array.from(input.files).forEach(file => {
          const pill = document.createElement('div');
          pill.className = 'file-pill';

          const name = document.createElement('span');
          name.textContent = file.name;

          const actions = document.createElement('div');
          actions.className = 'actions';

         

          const remove = document.createElement('button');
          remove.className = 'delete';
          remove.innerHTML = 'üóëÔ∏è';
          remove.onclick = () => pill.remove();

          actions.appendChild(remove);

          pill.appendChild(name);
          pill.appendChild(actions);

          list.appendChild(pill);
        });

      });
    }


    setupUpload('file-1', 'list-1');
    setupUpload('file-2', 'list-2');
    setupUpload('file-3', 'list-3');

    
  </script>


    <script src="/static/notification_scripts.js"></script>


</body>
</html>