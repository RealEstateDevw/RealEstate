<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="/static/admin_style/style.css">
        
        <link rel="stylesheet" href="/static/register-employer-style.css">
        <title>CRM</title>
    
        <style>
            body {
                background: {% if user and user.background_theme %} url('{{ user.background_theme }}')  lightgray 50% / cover no-repeat {% else %} #ffffff {% endif %};
                transition: background 0.5s ease;
            }
            .main-form-excel{
                margin-top: 10px;
    display: flex
;
    align-items: center;
    justify-content: center;
}
            
            .container {
      width: 800px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    p.subtitle {
      text-align: center;
      color: #666;
    }
    .section {
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 20px;
      padding: 15px;
    }
    .section-header {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .section-description {
      color: #666;
      margin-bottom: 10px;
    }
    .dropzone {
      border: 2px dashed #ccc;
      border-radius: 6px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.3s, background-color 0.3s;
      margin-bottom: 10px;
    }
    .dropzone:hover {
      border-color: #999;
      background-color: #f0f0f0;
    }
    .files-list {
      list-style: none;
      padding: 0;
    }
    .file-item {
      background: #f9f9f9;
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .file-item span {
      font-size: 0.9em;
      color: #333;
    }
    .file-item button {
      background: transparent;
      border: none;
      color: #e74c3c;
      cursor: pointer;
      font-size: 0.9em;
    }
    .buttons {
      text-align: right;
    }
    .buttons button {
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }
    .btn-primary {
      background: #216BF4;
      color: #fff;
    }
        </style>
    </head>
<body>
  <div id="notification" class="notification" style="display: none;">
    <span id="notification-message"></span>
    <button id="close-notification" class="close-btn">&times;</button>
</div>
{% include 'partials/admin-header.html' %}
<main>
    {% block content %}{% endblock %}
</main>



    <div class="main-form-excel">
        <div class="container">
    <h2>–ó–∞–≥—Ä—É–∑–∫–∞ Excel‚Äë—Ñ–∞–π–ª–æ–≤</h2>
    <p class="subtitle">–§–∞–π–ª—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º: –ü—Ä–∞–π—Å—ã, –î–∞–Ω–Ω—ã–µ –æ –ñ–ö, –®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤.</p>
    
    <!-- –°–µ–∫—Ü–∏—è 1: –ü—Ä–∞–π—Å—ã -->
    <div class="section" id="section-prices">
      <div class="section-header">(1) –ü—Ä–∞–π—Å—ã</div>
      <div class="section-description">
        –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel‚Äë—Ñ–∞–π–ª—ã —Å –ø—Ä–∞–π—Å–∞–º–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx, .xls, .csv
      </div>
      <div class="dropzone" onclick="document.getElementById('fileInput-prices').click()">
        <div style="font-size: 48px;">üìÑ</div>
        <div>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
      </div>
      <input type="file" id="fileInput-prices" multiple style="display:none" accept=".xlsx,.xls,.csv">
      <ul class="files-list" id="filesList-prices"></ul>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è 2: –î–∞–Ω–Ω—ã–µ –æ –ñ–ö -->
    <div class="section" id="section-jk">
      <div class="section-header">(2) –î–∞–Ω–Ω—ã–µ –æ –ñ–ö</div>
      <div class="section-description">
        –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel‚Äë—Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ñ–ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx, .xls, .csv
      </div>
      <div class="dropzone" onclick="document.getElementById('fileInput-jk').click()">
        <div style="font-size: 48px;">üìÑ</div>
        <div>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
      </div>
      <input type="file" id="fileInput-jk" multiple style="display:none" accept=".xlsx,.xls,.csv">
      <ul class="files-list" id="filesList-jk"></ul>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è 3: –®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤ -->
    <div class="section" id="section-templates">
      <div class="section-header">(3) –®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤</div>
      <div class="section-description">
        –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel‚Äë—à–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx, .xls
      </div>
      <div class="dropzone" onclick="document.getElementById('fileInput-templates').click()">
        <div style="font-size: 48px;">üìÑ</div>
        <div>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
      </div>
      <input type="file" id="fileInput-templates" multiple style="display:none" accept=".xlsx,.xls">
      <ul class="files-list" id="filesList-templates"></ul>
    </div>
    
    <div class="buttons">
      <button class="btn-primary" onclick="uploadFiles()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>
  </div>
        
    </div>
    <script src="/static/notification_scripts.js"></script>
<script>

function handleFiles(inputId, listId) {
      let input = document.getElementById(inputId);
      let list = document.getElementById(listId);
      list.innerHTML = "";
      for (let i = 0; i < input.files.length; i++) {
        let file = input.files[i];
        let li = document.createElement("li");
        li.className = "file-item";
        li.innerHTML = "<span>" + file.name + " (" + Math.round(file.size / 1024) + " –ö–ë)</span>" +
                       '<button onclick="removeFile(\'' + inputId + '\', this)">–£–¥–∞–ª–∏—Ç—å</button>';
        list.appendChild(li);
      }
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
    document.getElementById("fileInput-prices").addEventListener("change", function() {
      handleFiles("fileInput-prices", "filesList-prices");
    });
    document.getElementById("fileInput-jk").addEventListener("change", function() {
      handleFiles("fileInput-jk", "filesList-jk");
    });
    document.getElementById("fileInput-templates").addEventListener("change", function() {
      handleFiles("fileInput-templates", "filesList-templates");
    });
    
    // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ (–≤–∏–∑—É–∞–ª—å–Ω–æ)
    function removeFile(inputId, btn) {
      // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è, —É–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞.
      let li = btn.parentElement;
      li.parentElement.removeChild(li);
    }
    
    // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ (–æ—Ç–º–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏)
    function cancelUpload() {
      document.getElementById("fileInput-prices").value = "";
      document.getElementById("filesList-prices").innerHTML = "";
      
      document.getElementById("fileInput-jk").value = "";
      document.getElementById("filesList-jk").innerHTML = "";
      
      document.getElementById("fileInput-templates").value = "";
      document.getElementById("filesList-templates").innerHTML = "";
    }
    async function uploadFiles() {
    // –ú–∞—Å—Å–∏–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–µ–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ category
    const sections = ['prices', 'jk', 'templates'];
    const endpoint = '/api/complexes/add-excel-files-api';
    
    for (const section of sections) {
      const fileInput = document.getElementById(`fileInput-${section}`);
      if (!fileInput || fileInput.files.length === 0) {
        continue;
      }
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–¥–µ–ª—å–Ω–æ
      for (const file of fileInput.files) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('category', section); // –ü–µ—Ä–µ–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
        
        try {
          const response = await fetch(endpoint, {
            method: 'POST',
            body: formData
          });
          
          const result = await response.json();
          
          if (!response.ok) {
            // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –≤—ã–≤–æ–¥–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            showNotification(result.detail || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞', 'error');
          } else {
            // –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
            showNotification(result.message, 'success');
            // –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å UI, –Ω–∞–ø—Ä–∏–º–µ—Ä, —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –∏–∑ —Å–ø–∏—Å–∫–∞
          }
        } catch (error) {
          showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
          console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ ${file.name}:`, error);
        }
      }
    }
  }
</script>
</script>
</body>
</html>